---
phase: 01-secure-foundation
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/seed.ts
  - scripts/seed-profiles.ts
  - README.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Convex database has seed data for development"
    - "Developers can run a seed script to populate bot profiles"
    - "Documentation explains how to upload profiles via CLI"
    - "FeaturedBotsSection displays real data from database"
  artifacts:
    - path: "convex/seed.ts"
      provides: "Seed mutation for development data"
      exports: ["seedDevProfiles"]
    - path: "scripts/seed-profiles.ts"
      provides: "CLI script to seed profiles"
      min_lines: 50
    - path: "README.md"
      provides: "Documentation for profile upload"
      contains: "npx botarena generate --yes"
  key_links:
    - from: "scripts/seed-profiles.ts"
      to: "convex/seed.ts"
      via: "ctx.runMutation"
    - from: "FeaturedBotsSection"
      to: "convex/botProfiles.ts"
      via: "listProfiles query"
---

<objective>
Fix Gap 5: Profile Pages 404 - No Data in Convex Database

Purpose: The Convex backend is correctly wired but the botProfiles table is empty, causing /bots/[slug] to return 404. This gap closure creates seed data and documentation for profile population.

Output: Seed script to populate development profiles and clear documentation for uploading real profiles.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/01-secure-foundation/01-secure-foundation-UAT.md

## Gap 5 Details (from UAT.md Test 8)
- **Truth**: "Navigating to /bots/[slug] shows individual bot profile page with full details"
- **Status**: Failed
- **Severity**: blocker
- **User reported**: "it doesnt because the convex backend is not wired up properly or has no data in the db so thah http://localhost:3000/bots/devbot-v1/ goes 404"
- **Root cause**: "Convex backend is correctly wired up but botProfiles table is completely empty. FeaturedBotsSection.tsx shows hardcoded sample bots that don't exist in database."
- **Artifacts**:
  - path: "src/app/bots/[slug]/page.tsx" - Fetches from Convex HTTP API which returns 404 for missing slugs
  - path: "src/components/FeaturedBotsSection.tsx" - Displays hardcoded bots (devbot-v1, etc.) that don't exist in DB
  - path: "convex/botProfiles.ts" - getBySlug query returns null - no seed data
- **Missing**:
  - Bot profiles uploaded to Convex database via CLI
  - Seed data script for development
  - Documentation on how to upload profiles
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Convex seed mutation for development profiles</name>
  <files>convex/seed.ts</files>
  <action>
    Create convex/seed.ts with a seed mutation for development:
    
    1. Import necessary Convex functions:
    ```typescript
    import { v } from "convex/values";
    import { mutation } from "./_generated/server";
    import { api } from "./_generated/api";
    ```
    
    2. Define sample bot profiles (3-4 diverse examples):
    ```typescript
    const SAMPLE_BOTS = [
      {
        slug: "devbot-v1",
        name: "DevBot",
        description: "A helpful development assistant with deep knowledge of modern web technologies.",
        llm: { primary: "claude-3-sonnet", fallbacks: ["gpt-4"] },
        skills: ["typescript", "react", "nextjs", "tailwind", "convex"],
        mcps: ["filesystem", "github", "terminal"],
        clis: ["botarena", "clawdbot"],
        harness: "ClawdBot",
        version: "1.0.0",
        runtime: "ClawdBot",
      },
      {
        slug: "code-reviewer-pro",
        name: "Code Reviewer Pro",
        description: "Expert at reviewing code for security, performance, and best practices.",
        llm: { primary: "gpt-4", fallbacks: [] },
        skills: ["security", "performance", "testing", "ci-cd"],
        mcps: ["github", "gitlab"],
        clis: ["eslint", "prettier"],
        harness: "ClawdBot",
        version: "2.1.0",
        runtime: "ClawdBot",
      },
      {
        slug: "docs-writer",
        name: "Documentation Writer",
        description: "Specializes in creating clear, comprehensive technical documentation.",
        llm: { primary: "claude-3-opus", fallbacks: ["claude-3-sonnet"] },
        skills: ["technical-writing", "markdown", "api-docs", "tutorials"],
        mcps: ["filesystem", "web-search"],
        clis: ["mdbook", "vitepress"],
        harness: "ClawdBot",
        version: "0.5.0",
        runtime: "ClawdBot",
      },
    ];
    ```
    
    3. Create seedDevProfiles mutation:
    ```typescript
    export const seedDevProfiles = mutation({
      args: {},
      handler: async (ctx) => {
        const existing = await ctx.db.query("botProfiles").collect();
        
        if (existing.length > 0) {
          console.log(`Database already has ${existing.length} profiles, skipping seed`);
          return { seeded: 0, message: "Database already populated" };
        }
        
        for (const bot of SAMPLE_BOTS) {
          await ctx.db.insert("botProfiles", {
            ...bot,
            createdAt: Date.now(),
            updatedAt: Date.now(),
          });
        }
        
        return { seeded: SAMPLE_BOTS.length, message: "Development profiles seeded successfully" };
      },
    });
    ```
    
    4. Also create a clearDevProfiles mutation for cleanup:
    ```typescript
    export const clearDevProfiles = mutation({
      args: {},
      handler: async (ctx) => {
        const profiles = await ctx.db.query("botProfiles").collect();
        for (const profile of profiles) {
          await ctx.db.delete(profile._id);
        }
        return { cleared: profiles.length };
      },
    });
    ```
  </action>
  <verify>grep -q "seedDevProfiles" convex/seed.ts && grep -q "SAMPLE_BOTS" convex/seed.ts</verify>
  <done>Convex seed mutation created with 3+ sample bot profiles</done>
</task>

<task type="auto">
  <name>Task 2: Create CLI script to run seed mutation</name>
  <files>scripts/seed-profiles.ts</files>
  <action>
    Create scripts/seed-profiles.ts to invoke the seed mutation:
    
    1. Set up as a runnable TypeScript script:
    ```typescript
    #!/usr/bin/env tsx
    
    import { ConvexHttpClient } from "convex/browser";
    
    const CONVEX_URL = process.env.CONVEX_URL || "http://localhost:3210";
    
    async function seedProfiles() {
      console.log("Seeding development bot profiles...");
      console.log(`Connecting to Convex at ${CONVEX_URL}`);
      
      const client = new ConvexHttpClient(CONVEX_URL);
      
      try {
        // We need to call the mutation via HTTP action
        const response = await fetch(`${CONVEX_URL}/api/seed`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "seed" }),
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log("Seed result:", result);
        
        if (result.seeded > 0) {
          console.log(`✅ Seeded ${result.seeded} development profiles`);
          console.log("Visit http://localhost:3000 to see them");
        } else {
          console.log("ℹ️ " + result.message);
        }
      } catch (error) {
        console.error("❌ Failed to seed profiles:", error);
        console.log("\nMake sure:");
        console.log("  1. Convex dev server is running: npx convex dev");
        console.log("  2. CONVEX_URL is set correctly");
        process.exit(1);
      }
    }
    
    seedProfiles();
    ```
    
    2. Alternative: Add seed endpoint to convex/http.ts instead:
    ```typescript
    // In convex/http.ts, add to the request handler:
    if (request.method === "POST" && path === "/api/seed") {
      const result = await ctx.runMutation(api.seed.seedDevProfiles, {});
      return new Response(JSON.stringify(result), {
        status: 200,
        headers: { "Content-Type": "application/json" },
      });
    }
    ```
    
    3. Add package.json script:
    ```json
    "scripts": {
      "seed": "tsx scripts/seed-profiles.ts",
      "db:seed": "convex dev --once && tsx scripts/seed-profiles.ts"
    }
    ```
  </action>
  <verify>grep -q "seed-profiles" package.json || grep -q '"seed"' package.json</verify>
  <done>Seed script created and package.json script added</done>
</task>

<task type="auto">
  <name>Task 3: Add seed endpoint to convex/http.ts</name>
  <files>convex/http.ts</files>
  <action>
    Update convex/http.ts to add a seed endpoint:
    
    1. Import the seed mutation at the top:
    ```typescript
    import { api } from "./_generated/api";
    ```
    
    2. Add seed endpoint handler in the httpRouter:
    ```typescript
    http.route({
      path: "/api/seed",
      method: "POST",
      handler: httpAction(async (ctx, request) => {
        // Only allow in development
        if (process.env.NODE_ENV === "production") {
          return new Response(JSON.stringify({ error: "Seed not allowed in production" }), {
            status: 403,
            headers: { "Content-Type": "application/json" },
          });
        }
        
        const result = await ctx.runMutation(api.seed.seedDevProfiles, {});
        return new Response(JSON.stringify(result), {
          status: 200,
          headers: { "Content-Type": "application/json" },
        });
      }),
    });
    ```
    
    3. Or add to existing handler if using a switch/if pattern:
    ```typescript
    if (path === "/api/seed" && request.method === "POST") {
      const result = await ctx.runMutation(api.seed.seedDevProfiles, {});
      return new Response(JSON.stringify(result), { status: 200 });
    }
    ```
  </action>
  <verify>grep -q "/api/seed" convex/http.ts</verify>
  <done>Seed endpoint added to Convex HTTP router</done>
</task>

<task type="auto">
  <name>Task 4: Update README with profile upload instructions</name>
  <files>README.md</files>
  <action>
    Update README.md with clear instructions for populating profiles:
    
    1. Add a "Getting Started" section after installation:
    ```markdown
    ## Getting Started
    
    ### Option 1: Seed with Development Data (Quickest)
    
    Populate the database with sample bot profiles:
    
    ```bash
    # Start Convex dev server
    npx convex dev
    
    # In another terminal, seed the database
    npm run seed
    # or
    pnpm seed
    ```
    
    Then visit http://localhost:3000 to see the featured bots.
    
    ### Option 2: Upload Your Own Bot
    
    1. Navigate to your ClawdBot project:
    ```bash
    cd /path/to/your/bot
    ```
    
    2. Generate and upload your bot profile:
    ```bash
    # Non-interactive (for CI/CD)
    npx botarena@latest generate --description "My awesome bot" --yes
    
    # Interactive (for humans)
    npx botarena@latest generate --interactive
    ```
    
    3. The CLI will output a public URL like:
    ```
    Profile uploaded successfully!
    View your bot: http://localhost:3000/bots/your-bot-name
    ```
    
    ### Troubleshooting
    
    **Profile page returns 404?**
    - Ensure Convex is running: `npx convex dev`
    - Seed the database: `npm run seed`
    - Or upload a profile first (see Option 2 above)
    
    **Seeing "coming soon" instead of CLI help?**
    - Clear npx cache: `npx clear-npx-cache` or `rm -rf ~/.npm/_npx`
    - Use explicit version: `npx botarena@latest --help`
    ```
    
    2. Ensure this section is prominent and easy to find.
  </action>
  <verify>grep -q "npm run seed" README.md && grep -q "npx botarena@latest" README.md</verify>
  <done>README updated with seed instructions and upload documentation</done>
</task>

</tasks>

<verification>
**Gap 5 Closure Verification:**

1. **Seed script**: Run `npm run seed` and verify it creates profiles in Convex
2. **Profile page**: Visit http://localhost:3000/bots/devbot-v1 and verify it loads (not 404)
3. **Featured section**: Homepage shows seeded bots instead of hardcoded ones
4. **Documentation**: README has clear instructions for both seeding and uploading
5. **CLI upload**: `npx botarena@latest generate --description "Test" --yes` works and creates accessible profile
</verification>

<success_criteria>
- [ ] Convex seed.ts mutation exists with 3+ sample bots
- [ ] Seed endpoint accessible at POST /api/seed
- [ ] npm run seed script works and populates database
- [ ] /bots/devbot-v1 loads successfully with full profile
- [ ] README documents both seeding and CLI upload methods
- [ ] Hardcoded bots in FeaturedBotsSection replaced with database query
</success_criteria>

<output>
After completion, create `.planning/phases/01-secure-foundation/01-10-SUMMARY.md`
</output>
