---
phase: 01-secure-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: ["package.json", "src/cli/index.ts", "src/cli/commands/generate.ts", "src/schemas/bot-config.ts", "tsconfig.json", "oclif.manifest.json"]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can run `npx botarena generate` command successfully"
    - "CLI tool has proper oclif structure with TypeScript"
    - "Bot configuration schema validates public fields only"
    - "No sensitive config fields are accessible via schema"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and CLI bin configuration"
      contains: "oclif, @modelcontext/sdk, zod dependencies"
    - path: "src/cli/index.ts"
      provides: "CLI entry point with oclif initialization"
      min_lines: 20
    - path: "src/cli/commands/generate.ts"
      provides: "Main botarena generate command implementation"
      min_lines: 30
    - path: "src/schemas/bot-config.ts"
      provides: "Zod schema for public bot configuration validation"
      contains: "PublicBotConfig schema"
  key_links:
    - from: "src/cli/commands/generate.ts"
      to: "src/schemas/bot-config.ts"
      via: "schema import and validation"
      pattern: "import.*PublicBotConfig"
    - from: "package.json"
      to: "src/cli/index.ts"
      via: "bin field and oclif setup"
      pattern: "\"bin\":.*\"botarena\""
---

<objective>
Create CLI foundation with oclif framework and bot configuration schema validation for secure profile generation.

Purpose: Establish the command-line interface foundation that securely interacts with bot runtimes using MCP SDK while validating configuration data before any storage operations.
Output: Working `npx botarena generate` command with schema validation and MCP integration scaffolding.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/phases/01-secure-foundation/01-DISCOVERY.md
@.planning/research/STACK.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize project dependencies and oclif structure</name>
  <files>package.json, tsconfig.json, oclif.manifest.json</files>
  <action>
  1. Update package.json to include:
     - oclif 4.0+ dependencies (@oclif/core, @oclif/plugin-help)
     - MCP SDK (@modelcontext/sdk)
     - TypeScript and development dependencies
     - CLI binary configuration: "bin": {"botarena": "./dist/cli/index.js"}
     - Build scripts for TypeScript compilation
  
  2. Create tsconfig.json with:
     - Target: ES2022, Module: ESNext
     - Strict mode enabled for type safety
     - OutDir: ./dist for compiled CLI
  
  3. Create basic oclif.manifest.json for CLI structure
     - Version: "1.0.0"
     - Commands: ["generate"]
  
  4. Install all dependencies using npm
  
  From STACK.md research: Use oclif 4.0+ for TypeScript-native CLI development with excellent plugin support.
  </action>
  <verify>npm install completes successfully and package.json structure is valid</verify>
  <done>Project dependencies installed and CLI structure scaffolded with oclif framework</done>
</task>

<task type="auto">
  <name>Task 2: Create CLI entry point and generate command structure</name>
  <files>src/cli/index.ts, src/cli/commands/generate.ts</files>
  <action>
  1. Create src/cli/index.ts:
     - Import and initialize oclif with proper configuration
     - Set up CLI version and help system
     - Export main CLI runner function
  
  2. Create src/cli/commands/generate.ts:
     - Extend oclif.Command class
     - Implement basic command structure with description and flags
     - Add --interactive flag for user prompts
     - Add --dry-run flag for testing without upload
     - Scaffold MCP integration point (import statement, method stubs)
  
  3. Use TypeScript decorators for oclif command configuration
     - @Command decorator with proper description
     - @Flags decorator for command options
  
  From DISCOVERY.md: Use interactive prompts and progress indicators for better UX.
  </action>
  <verify>npx tsc compiles TypeScript files without errors</verify>
  <done>CLI entry point and generate command scaffolded with proper oclif structure and TypeScript support</done>
</task>

<task type="auto">
  <name>Task 3: Implement secure bot configuration schema validation</name>
  <files>src/schemas/bot-config.ts</files>
  <action>
  1. Create src/schemas/bot-config.ts with Zod schemas:
  
  ```typescript
  import { z } from 'zod';

  // Strict schema for public bot configuration only
  export const PublicBotConfig = z.object({
    name: z.string().min(1).max(100),
    description: z.string().min(1).max(500), // "yearbook quote"
    llm: z.object({
      primary: z.string(),
      fallbacks: z.array(z.string()).optional()
    }),
    skills: z.array(z.string()),
    mcps: z.array(z.string()),
    clis: z.array(z.string()),
    harness: z.string(),
    version: z.string()
  });

  // Schema for MCP query responses
  export const MCPResponse = z.object({
    success: z.boolean(),
    data: z.unknown(),
    error: z.string().optional()
  });
  ```
  
  2. Add validation functions:
     - validatePublicConfig(config: unknown): PublicBotConfig
     - sanitizeConfig(rawConfig: unknown): PublicBotConfig
     - isSafeForPublicDisplay(config: PublicBotConfig): boolean
  
  3. Add detailed comments explaining security boundaries and why sensitive fields are excluded
  
  From DISCOVERY.md: Implement Gatekeeper pattern with strict schema validation to prevent sensitive data leakage.
  </action>
  <verify>Zod schema compilation passes validation tests</verify>
  <done>Secure bot configuration schema implemented with validation for public fields only</done>
</task>

</tasks>

<verification>
- CLI compiles successfully with TypeScript
- Basic `npx botarena --help` command works
- `npx botarena generate --help` shows command description and flags
- Schema validation catches invalid configurations and rejects sensitive fields
- No sensitive configuration fields are included in PublicBotConfig schema
</verification>

<success_criteria>
- User can run `npx botarena` command and see help output
- User can run `npx botarena generate --help` and see available flags  
- CLI has proper TypeScript compilation and type checking
- Bot configuration schema validates public fields only and excludes sensitive data
- MCP integration is scaffolded and ready for implementation
</success_criteria>

<output>
After completion, create `.planning/phases/01-secure-foundation/01-01-SUMMARY.md`
</output>